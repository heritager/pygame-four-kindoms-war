# 四国争霸 - 策略战争游戏

一个基于Pygame开发的回合制策略战争游戏，支持多人对战和单人AI对战模式。

## 游戏略图

![游戏略图](example.png)

## 游戏简介

四国争霸是一款经典的领土争夺策略游戏，四位玩家（或三位AI）在一个20x20的棋盘上争夺领土、占领城市、消灭对手。游戏包含丰富的地形系统、城市生产机制和智能AI对手。

## 未来开发计划 (ToDo List)

### 1. 单位形态系统

根据士兵血量实现不同的单位形态，增加游戏策略深度：

| 血量范围 | 单位形态 | 特点 |
|----------|----------|------|
| 1-20 | 士兵 | 基础战斗单位 |
| 21-50 | 坦克 | 重型战斗单位 |
| 51-99 | 飞机 | 空中单位，无视地形限制 |

**实现要点：**
- 不同形态有不同的外观和移动规则
- 坦克单轮内首次移动消耗增加1点，后续移动消耗正常
- 飞机可以跨越地形障碍，移动范围更大

### 2. 地图关卡系统

设计不同难度的地图关卡，独特地形布局，特殊规则限制，提供多样化的游戏体验：

- **特殊关卡**：
  - 包含特殊地形（如森林、沙漠）
  - 有独特的资源分布和生产机制
  - 可能引入新的单位形态或移动规则

**实现要点：**
- 预设多个地图配置文件
- 关卡选择界面
- 关卡进度保存
- 不同关卡的地形生成参数调整

### 3. 海洋与港口系统

重新设计水域系统，增加战略深度：

**海洋设计：**
- 海域必须连片位于地图中央
- 海域大小和形状可配置

**港口系统：**
- 在海边设置港口建筑
- 只有从港口才能进入水域
- 水中单位可以在任意位置登陆

**水上单位形态：**
- 士兵（1-20血量）→ 小型游艇
- 坦克（21-50血量）→ 大型游艇
- 飞机（51-99血量）→ 保持飞机形态

**实现要点：**
- 港口建筑的特殊标记
- 水域移动规则调整
- 不同单位的水上形态渲染
- 港口占领和防御机制

### 4. 士气系统

引入士气机制，增加游戏的动态性和策略性：

**士气影响因素：**
- **总兵力**：己方所有士兵血量总和
- **总领土**：己方控制的领土数量
- **最近战斗胜率**：最近N次战斗的胜率

**士气等级：**
- **低士气**：单位战斗力降低10%
- **普通士气**：单位战斗力正常
- **高士气**：单位战斗力提升10%，并有小概率实现"以弱胜强"
- **超高士气**：单位战斗力提升20%，并有较大概率实现"以弱胜强"

**士气效果：**
- 士气影响单位的基础血量
- 高士气增加战斗胜率计算
- 士气波动影响AI决策
- 士气系统可视化显示

**实现要点：**
- 士气计算公式设计
- 士气等级划分和效果
- 士气变化触发条件
- UI界面显示当前士气
- 士气对战斗结果的影响机制

## 游戏模式

### 1. 统一主入口 (game_main.py)

启动后可在菜单中选择两种模式：
- 4人本地对战（Hotseat）
- 1人对战3个AI（Single vs AI）
- 地图关卡（MVP）：均衡大陆 / 高地战区 / 群岛海战

### 2. 单人入口 (single_mode_main.py)

直接进入“1人对战3个AI”模式。

兼容说明：
- `Game.py` 与 `Single_Game.py` 仍可启动，但仅作为兼容转发入口。

## 游戏规则

### 基本规则

1. **回合制**：每位玩家轮流行动，每回合有固定的行动点数
2. **行动点数**：
   - 第1-5轮：每回合3步
   - 第6-10轮：每回合6步
   - 第11轮起：每回合10步
3. **胜利条件**：占领敌方首都消灭对手，最后存活的玩家获胜

### 地形系统

游戏包含四种地形，每种地形有不同的移动规则：

| 地形 | 颜色 | 移动规则 |
|------|------|----------|
| 平原 | 灰蓝色 | 只能上下左右移动1格，消耗1行动点 |
| 森林 | 绿色 | 可向八个方向移动1格（包括斜向），消耗1行动点 |
| 山脉 | 灰色 | 只能上下左右移动，消耗2行动点 |
| 水域 | 蓝色 | 水域中可移动2格，登陆陆地限制1格，消耗1行动点 |

**特殊规则：**
- 陆地棋子可以进入水域（距离限制1格）
- 山脉移动消耗加倍
- 森林支持斜向移动

### 城市系统

城市分为三种类型，具有不同的生产能力：

| 城市类型 | 外观 | 每轮生产量 |
|----------|------|-------------|
| 小城市 | 小方形建筑 | +1士兵 |
| 大城市 | 中等方形建筑 | +2士兵 |
| 首都 | 大型建筑+金色屋顶 | +2士兵 |

**规则：**
- 城市每轮结束后自动生产士兵
- 士兵血量上限为99
- 占领敌方城市可获得生产能力
- 首都被占领则该玩家被淘汰

### 战斗规则

1. **攻击**：移动到敌方士兵位置触发战斗
2. **胜负判定**：
   - 攻击方血量 > 防守方血量：攻击方获胜，剩余血量为两者之差
   - 攻击方血量 < 防守方血量：防守方获胜，剩余血量为两者之差
   - 血量相等：同归于尽，双方都消失
3. **领土占领**：战斗胜利后占领该位置领土（水域除外）

### 领土系统

1. **包围占领**：无士兵的领土如果被完全包围，会自动归属于包围者
2. **领土颜色**：半透明覆盖显示领土归属
3. **领土计数**：实时显示各方领土数量

### 士兵规则

1. **移动限制**：每个士兵每回合最多移动3次
2. **移动次数显示**：士兵左上角显示当前移动次数（如"1/3"）
3. **血量显示**：士兵中心显示当前血量

## 操作说明

### 多人模式 (game_main.py)

- **鼠标左键**：点击选择士兵，点击目标位置移动
- **结束回合按钮**：主动结束当前回合
- **R键**：重新开始游戏
- **主菜单**：按键 1/2 选模式，按键 1/2/3 选地图关卡
- **ESC键**：退出游戏

### 单人模式 (single_mode_main.py)

- **鼠标左键**：点击选择士兵，点击目标位置移动
- **结束回合按钮**：主动结束当前回合
- **AI自动行动**：AI回合时自动执行移动
- **主菜单**：按键 1/2 选模式，按键 1/2/3 选地图关卡
- **ESC键**：退出游戏

## AI系统

单人模式中的AI采用智能评分系统，综合考虑以下因素：

### 评分因素

1. **占领价值**
   - 首都：15倍基础分
   - 大城市：10倍基础分
   - 小城市：6倍基础分
   - 普通领土：2倍基础分

2. **地形价值**
   - 森林：1.5倍加分
   - 平原：1倍加分

3. **战斗评估**
   - 击败敌人获得高分
   - 防守成功获得中等分
   - 同归于尽获得基础分

4. **威胁评估**
   - 周围敌人越多，位置得分越低
   - 优先避免危险位置

5. **战略目标**
   - 接近敌方首都获得额外加分
   - 领土扩张获得加分

6. **防御考虑**
   - 保护首都附近领土
   - 避免首都被威胁

### AI行为特点

- 优先占领高价值目标
- 平衡进攻与防御
- 有一定的思考延迟，模拟真实玩家
- 根据局势动态调整策略

## 安装说明

### 环境要求

- Python 3.7+
- Pygame 2.0+
- NumPy 1.19+

### 安装步骤

1. 克隆或下载项目到本地
2. 安装依赖库：
   ```bash
   pip install -r requirements.txt
   ```
3. 运行游戏：
   ```bash
   # 统一入口（推荐）：启动后在菜单中选模式
   python3 game_main.py

   # 单人入口：直接进入单人AI模式
   python3 single_mode_main.py

   # 旧命名入口（兼容）
   python3 Game.py
   python3 Single_Game.py
   ```

## 前端设计

游戏包含精美的视觉效果：
- 动态水域波浪动画
- 详细的森林和山脉绘制
- 独特的城市建筑风格
- 清晰的领土颜色标识
- 直观的UI界面

## 游戏特性

### 视觉效果
- 精美的地形渲染
- 动态水域效果
- 半透明领土覆盖
- 城市建筑细节
- 士兵血量和移动次数显示

### 游戏机制
- 智能AI对手
- 领土包围系统
- 城市生产机制
- 多样化地形规则
- 回合制行动点系统

### 用户体验
- 实时游戏日志
- 领地数量统计
- 可移动范围高亮
- 选中状态提示
- 流畅的游戏节奏

## 开发说明

### 项目结构

```
.
├── game_main.py         # 统一主入口 + 游戏核心逻辑
├── single_mode_main.py  # 单人模式入口
├── app_controller.py    # 应用循环与模式菜单
├── ai_logic.py          # AI决策逻辑
├── map_presets.py       # 地图关卡预设
├── map_generation.py    # 地形/城市/金矿生成
├── render_mixin.py      # 渲染与HUD
├── constants.py         # 常量与颜色配置
├── Game.py              # 兼容旧入口（转发到 game_main.py）
├── Single_Game.py       # 兼容旧入口（转发到 single_mode_main.py）
├── README.md            # 项目文档
└── requirements.txt     # 依赖库列表
```

### 核心类

- `Game`: 游戏主类，整合地图生成、AI与渲染逻辑
- `App`: 应用控制器，负责事件循环与模式选择
- `AIMixin`: AI决策与行动规划

### 主要方法

- `move_soldier()`: 处理士兵移动和战斗
- `calculate_possible_moves()`: 计算可移动位置
- `calculate_territories()`: 计算领土归属
- `production_phase()`: 生产阶段处理
- `next_player()`: 切换到下一个玩家

## 技术栈

- **Python**: 主要编程语言
- **Pygame**: 游戏引擎和图形渲染
- **NumPy**: 数值计算和矩阵操作

## 许可证

本项目仅供学习和娱乐使用。

## 贡献

欢迎提出建议和改进意见！

## 更新日志

### v1.0.0
- 初始版本发布
- 支持多人对战模式
- 支持单人AI对战模式
- 完整的地形和城市系统
- 智能AI评分系统
- 领土包围机制

## 联系方式

如有问题或建议，欢迎通过GitHub Issues联系。

---

**祝游戏愉快！** 🎮
